<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gralobe - Multi-Variant Test</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      background: #0a0a0f; 
      font-family: system-ui; 
      color: #fff;
      padding: 20px;
    }
    h1 { 
      text-align: center; 
      margin-bottom: 20px;
      color: #4af;
    }
    .description {
      text-align: center;
      color: #888;
      margin-bottom: 30px;
    }
    .grid {
      display: grid;
      gap: 20px;
    }
    .variant {
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      overflow: hidden;
    }
    .variant-header {
      padding: 10px 15px;
      background: #1a1a2e;
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .variant-title {
      font-weight: 600;
      color: #4af;
    }
    .variant-size {
      font-size: 12px;
      color: #666;
    }
    .variant-container {
      position: relative;
    }
    .status {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      z-index: 100;
    }
    .status.loading { background: #444; color: #aaa; }
    .status.ready { background: #143; color: #4f4; }
    .status.error { background: #411; color: #f44; }
    
    /* Different sizes for testing */
    .size-full { height: 500px; }
    .size-medium { height: 350px; }
    .size-small { height: 250px; }
    .size-tiny { height: 150px; }
    
    /* Row layouts */
    .row-single { grid-template-columns: 1fr; }
    .row-double { grid-template-columns: 1fr 1fr; }
    .row-triple { grid-template-columns: 1fr 1fr 1fr; }
    .row-quad { grid-template-columns: repeat(4, 1fr); }
    
    @media (max-width: 1200px) {
      .row-quad { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 800px) {
      .row-double, .row-triple, .row-quad { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <h1>Gralobe Multi-Variant Test</h1>
  <p class="description">
    Scroll down to see globes at different sizes. Check for:<br>
    • Labels positioning correctly at all sizes<br>
    • Legend showing correct statistic name<br>
    • No visual glitches
  </p>

  <!-- Full Width -->
  <div class="grid row-single" style="margin-bottom: 20px;">
    <div class="variant">
      <div class="variant-header">
        <span class="variant-title">Full Width (500px height)</span>
        <span class="variant-size">100% × 500px</span>
      </div>
      <div class="variant-container size-full" id="globe-full">
        <span class="status loading" id="status-full">Loading...</span>
      </div>
    </div>
  </div>

  <!-- Two Column -->
  <div class="grid row-double" style="margin-bottom: 20px;">
    <div class="variant">
      <div class="variant-header">
        <span class="variant-title">Half Width - Default Stat</span>
        <span class="variant-size">50% × 350px</span>
      </div>
      <div class="variant-container size-medium" id="globe-half1">
        <span class="status loading" id="status-half1">Loading...</span>
      </div>
    </div>
    <div class="variant">
      <div class="variant-header">
        <span class="variant-title">Half Width - Custom Stat</span>
        <span class="variant-size">50% × 350px</span>
      </div>
      <div class="variant-container size-medium" id="globe-half2">
        <span class="status loading" id="status-half2">Loading...</span>
      </div>
    </div>
  </div>

  <!-- Three Column -->
  <div class="grid row-triple" style="margin-bottom: 20px;">
    <div class="variant">
      <div class="variant-header">
        <span class="variant-title">Third Width</span>
        <span class="variant-size">33% × 250px</span>
      </div>
      <div class="variant-container size-small" id="globe-third1">
        <span class="status loading" id="status-third1">Loading...</span>
      </div>
    </div>
    <div class="variant">
      <div class="variant-header">
        <span class="variant-title">Third - No Labels</span>
        <span class="variant-size">33% × 250px</span>
      </div>
      <div class="variant-container size-small" id="globe-third2">
        <span class="status loading" id="status-third2">Loading...</span>
      </div>
    </div>
    <div class="variant">
      <div class="variant-header">
        <span class="variant-title">Third - Flat View</span>
        <span class="variant-size">33% × 250px</span>
      </div>
      <div class="variant-container size-small" id="globe-third3">
        <span class="status loading" id="status-third3">Loading...</span>
      </div>
    </div>
  </div>

  <!-- Four Column (tiny) -->
  <div class="grid row-quad">
    <div class="variant">
      <div class="variant-header">
        <span class="variant-title">Tiny 1</span>
        <span class="variant-size">25% × 150px</span>
      </div>
      <div class="variant-container size-tiny" id="globe-tiny1">
        <span class="status loading" id="status-tiny1">Loading...</span>
      </div>
    </div>
    <div class="variant">
      <div class="variant-header">
        <span class="variant-title">Tiny 2</span>
        <span class="variant-size">25% × 150px</span>
      </div>
      <div class="variant-container size-tiny" id="globe-tiny2">
        <span class="status loading" id="status-tiny2">Loading...</span>
      </div>
    </div>
    <div class="variant">
      <div class="variant-header">
        <span class="variant-title">Tiny 3</span>
        <span class="variant-size">25% × 150px</span>
      </div>
      <div class="variant-container size-tiny" id="globe-tiny3">
        <span class="status loading" id="status-tiny3">Loading...</span>
      </div>
    </div>
    <div class="variant">
      <div class="variant-header">
        <span class="variant-title">Tiny 4</span>
        <span class="variant-size">25% × 150px</span>
      </div>
      <div class="variant-container size-tiny" id="globe-tiny4">
        <span class="status loading" id="status-tiny4">Loading...</span>
      </div>
    </div>
  </div>

  <script type="module">
    import { GlobeViz } from './src/lib/GlobeViz.ts';

    // Custom statistic for testing (no format function - simulates JSON API)
    const customStatistic = {
      definition: {
        id: "coffee_consumption",
        name: "Coffee Consumption (kg/capita)",
        unit: "kg",
        description: "Annual coffee consumption per capita",
        colorScale: ["#f7e6d5", "#c9a87c", "#6f4e37"],
        domain: [0, 12]
      },
      values: {
        "840": 4.2, "276": 6.5, "250": 5.4, "380": 5.9, "826": 2.8,
        "752": 8.2, "578": 9.9, "246": 12.0, "208": 8.7, "528": 8.4,
        "756": 7.9, "040": 6.1, "056": 6.8, "620": 4.3, "300": 5.7,
        "616": 3.2, "203": 4.5, "348": 3.8, "642": 2.1, "100": 1.8,
        "156": 0.1, "356": 0.1, "392": 3.4, "410": 2.7, "036": 3.0,
        "124": 6.5, "076": 6.1, "032": 1.0, "484": 1.4, "152": 2.1,
        "170": 2.0, "604": 0.6, "862": 1.2, "218": 0.5, "858": 1.8,
        "643": 1.7, "804": 1.4, "792": 0.9, "682": 0.4, "818": 0.3
      }
    };

    async function createGlobe(containerId, statusId, config, customStat = null) {
      const status = document.getElementById(statusId);
      try {
        const globe = new GlobeViz(`#${containerId}`, config);
        
        // Wait for globe to be ready
        await globe.ready;
        
        // Set custom statistic if provided
        if (customStat) {
          globe.setStatistic(customStat);
        }
        
        status.textContent = 'Ready';
        status.className = 'status ready';
        
        return globe;
      } catch (err) {
        console.error(`Failed to create ${containerId}:`, err);
        status.textContent = 'Error';
        status.className = 'status error';
      }
    }

    // Create all variants
    const baseConfig = {
      autoRotate: true,
      showControls: false,
      showLegend: true,
      effects: { atmosphere: true, clouds: true }
    };

    // Full width - default statistic
    createGlobe('globe-full', 'status-full', { ...baseConfig, labels: 'major' });

    // Half width variants
    createGlobe('globe-half1', 'status-half1', { ...baseConfig, labels: 'major' });
    createGlobe('globe-half2', 'status-half2', { ...baseConfig, labels: 'major' }, customStatistic);

    // Third width variants
    createGlobe('globe-third1', 'status-third1', { ...baseConfig, labels: 'minimal' });
    createGlobe('globe-third2', 'status-third2', { ...baseConfig, labels: 'none' });
    createGlobe('globe-third3', 'status-third3', { ...baseConfig, labels: 'minimal', initialView: 'flat' });

    // Tiny variants
    createGlobe('globe-tiny1', 'status-tiny1', { ...baseConfig, labels: 'none', showLegend: false });
    createGlobe('globe-tiny2', 'status-tiny2', { ...baseConfig, labels: 'none', showLegend: false });
    createGlobe('globe-tiny3', 'status-tiny3', { ...baseConfig, labels: 'none', showLegend: false });
    createGlobe('globe-tiny4', 'status-tiny4', { ...baseConfig, labels: 'none', showLegend: false });
  </script>
</body>
</html>
